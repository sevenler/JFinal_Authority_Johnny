systemModule.controller("loginCtrl",["$scope","$rootScope","$timeout","$state","jbase","getMsg","api",function(e,o,a,c,n,t,l){e.remember=!1,e.click=!1,o.loadingTitle=t(Code.LOGING),e.captchaUrl="/captcha",e.changeCaptcha=function(){e.captchaUrl="/captcha?time="+(new Date).getTime()},l.login.rsa(function(a){a.code==Code.LOGING?(e.msg=t(a.code),o.loading=!0,n.delay(function(){o.loading=!1},null,555)):(a.data.email&&(e.email=a.data.email,e.remember=!0),e.exponent=a.data.exponent,e.modulus=a.data.modulus)}),o.loadClosed=function(){c.go("main")},e.login=function(o){if(o&&o.preventDefault(),e.email&&e.pwd&&!e.click){e.click=!0;var a="email="+e.email+"&pwd="+e.pwd,i=n.rsa(e.exponent,e.modulus,a);l.login.login({key:i,remember:e.remember,code:e.code},function(o){200==o.code?c.go("main"):(e.click=!1,e.msg=t(o.code),o.code==Code.CAPTCHA_ERROR&&(e.captcha=!0))})}}}]);